<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI Чат (Google Gemini)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
        .chat-container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .chat-box { height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 8px 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .user { background: #007bff; color: white; align-self: flex-end; }
        .ai { background: #e0e0e0; color: #333; align-self: flex-start; }
        .input-area { display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #218838; }
        .error { color: red; font-size: 0.9em; text-align: center; margin-top: 5px; }
    </style>
</head>
<body>

<div class="chat-container">
    <h2 style="text-align: center;">Чат с Gemini</h2>
    
    <!-- Поле для ввода ключа, чтобы можно было легко менять -->
    <div style="margin-bottom: 10px;">
        <label style="font-size: 12px; font-weight: bold;">Ваш API Ключ:</label>
        <input type="password" id="apiKey" style="width: 100%; box-sizing: border-box;" value="c714c3bc6d064b8ba26ce978822575e7.yx3IDmt7w6ETOZ9vz8SXX1X8">
    </div>

    <div class="chat-box" id="chatBox">
        <div class="message ai">Привет! Я Gemini 1.5 Flash. О чем поговорим?</div>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Введите сообщение..." onkeypress="if(event.key === 'Enter') sendMessage()">
        <button onclick="sendMessage()">Отправить</button>
    </div>
    <div id="errorMsg" class="error"></div>
</div>

<script>
    async function sendMessage() {
        const input = document.getElementById('userInput');
        const messageText = input.value.trim();
        const key = document.getElementById('apiKey').value;
        const chatBox = document.getElementById('chatBox');
        const errorMsg = document.getElementById('errorMsg');

        if (!messageText) return;
        if (!key) {
            errorMsg.innerText = "Пожалуйста, введите API ключ.";
            return;
        }

        // Очистка ошибок и добавление сообщения пользователя
        errorMsg.innerText = "";
        addMessage(messageText, 'user');
        input.value = '';
        input.disabled = true; // Блокируем ввод пока ждем ответ

        // Добавляем индикатор загрузки
        const loadingDiv = addMessage("Печатает...", 'ai');

        try {
            // URL для Gemini (ключ передается как параметр key=...)
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    // Структура Gemini отличается от OpenAI!
                    contents: [{
                        parts: [{
                            text: messageText
                        }]
                    }]
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error.message || `Ошибка HTTP: ${response.status}`);
            }

            const data = await response.json();
            
            // Удаляем индикатор загрузки
            chatBox.removeChild(loadingDiv);

            // Парсим ответ Gemini
            if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                const aiText = data.candidates[0].content.parts[0].text;
                addMessage(aiText, 'ai');
            } else {
                addMessage("Пришел пустой ответ от ИИ.", 'ai');
            }

        } catch (error) {
            chatBox.removeChild(loadingDiv);
            console.error(error);
            addMessage(`Ошибка: ${error.message}`, 'ai');
            
            if (error.message.includes('400') || error.message.includes('API key')) {
                errorMsg.innerText = "Скорее всего, этот API ключ не подходит для прямого доступа к Google Gemini. Проверьте провайдера ключа.";
            }
        } finally {
            input.disabled = false;
            input.focus();
        }
    }

    function addMessage(text, sender) {
        const chatBox = document.getElementById('chatBox');
        const div = document.createElement('div');
        div.className = `message ${sender}`;
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
        return div;
    }
</script>

</body>
</html>
