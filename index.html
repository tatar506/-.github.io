<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI Чат (Qwen 2.5)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .chat-box { background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: 0 auto; height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; border: 1px solid #ccc;}
        .message { padding: 10px; border-radius: 10px; max-width: 80%; }
        .user { background: #007bff; color: white; align-self: flex-end; }
        .ai { background: #e0e0e0; color: black; align-self: flex-start; }
        .controls { max-width: 600px; margin: 20px auto; display: flex; gap: 10px; }
        input { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #218838; }
        .settings { max-width: 600px; margin: 0 auto 20px; padding: 10px; background: #fff; border-radius: 5px; font-size: 12px; }
        .settings label { display: block; margin-bottom: 5px; font-weight: bold;}
        .settings input { width: 95%; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="settings">
        <label>API URL (Адрес сервера):</label>
        <!-- По умолчанию стоит OpenRouter, так как там есть Qwen -->
        <input type="text" id="apiUrl" value="https://openrouter.ai/api/v1/chat/completions">
        
        <label>API Key (Ваш ключ):</label>
        <input type="password" id="apiKey" value="c714c3bc6d064b8ba26ce978822575e7.yx3IDmt7w6ETOZ9vz8SXX1X8">
        
        <label>Имя модели:</label>
        <!-- Модель Qwen 2.5 Coder -->
        <input type="text" id="modelName" value="qwen/qwen-2.5-coder-7b-instruct">
    </div>

    <div class="chat-box" id="chatBox">
        <div class="message ai">Привет! Я настроен на Qwen 2.5 Coder (через OpenRouter). Если ваш ключ от другого сервиса, поменяйте URL выше.</div>
    </div>

    <div class="controls">
        <input type="text" id="userInput" placeholder="Введите сообщение...">
        <button onclick="sendMessage()">Отправить</button>
    </div>

    <script>
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value;
            if (!message) return;

            // Отображаем сообщение пользователя
            addMessage(message, 'user');
            input.value = '';

            const url = document.getElementById('apiUrl').value;
            const key = document.getElementById('apiKey').value;
            const model = document.getElementById('modelName').value;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${key}`,
                        // Некоторые сервисы требуют этот заголовок
                        'HTTP-Referer': window.location.href, 
                        'X-Title': 'My AI Chat'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: "user", content: message }
                        ]
                    })
                });

                if (!response.ok) {
                    const err = await response.text();
                    throw new Error(`Ошибка сервера (${response.status}): ${err}`);
                }

                const data = await response.json();
                const aiText = data.choices[0].message.content;
                addMessage(aiText, 'ai');

            } catch (error) {
                console.error(error);
                addMessage(`ОШИБКА: ${error.message}. Проверьте URL и Ключ!`, 'ai');
            }
        }

        function addMessage(text, sender) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerText = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
