<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaceOS Pro Prototype</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        :root { --android-green: #3ddc84; --bg-dark: #000; }
        body { margin: 0; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; overflow: hidden; }

        /* –°–º–∞—Ä—Ç—Ñ–æ–Ω */
        #phone {
            width: 360px;
            height: 740px;
            background: var(--bg-dark);
            border: 12px solid #333;
            border-radius: 45px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        /* –ö–∞–º–µ—Ä–∞ (–ø—Ä–µ–≤—å—é) */
        #cam-layer {
            position: absolute;
            top: 45px;
            right: 15px;
            width: 70px;
            height: 90px;
            border-radius: 12px;
            border: 2px solid var(--android-green);
            overflow: hidden;
            z-index: 1000;
            background: #222;
        }
        video { transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover; }

        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar { height: 35px; display: flex; justify-content: space-between; align-items: center; padding: 0 25px; font-size: 13px; z-index: 100; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –û–° */
        #screen-content { flex: 1; position: relative; width: 100%; }

        /* –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù */
        .desktop {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            padding: 20px;
            transition: 0.5s;
        }
        .app-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 15px;
            border: 2px solid transparent;
        }
        .app-node.active { border-color: var(--android-green); background: rgba(61, 220, 132, 0.2); transform: scale(1.1); }
        .app-icon { width: 55px; height: 55px; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 28px; margin-bottom: 5px; }

        /* –ü–†–ò–õ–û–ñ–ï–ù–ò–ï TIKTOK (FAKE) */
        #tiktok-app {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            overflow: hidden;
        }
        .tt-video {
            min-height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            border-bottom: 2px solid #222;
            position: relative;
        }
        .tt-ui { position: absolute; right: 10px; bottom: 50px; display: flex; flex-direction: column; gap: 20px; }
        .tt-btn { width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; justify-content: center; align-items: center; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .nav-bar { height: 50px; background: rgba(0,0,0,0.9); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #222; }
        .nav-btn { width: 18px; height: 18px; border: 2px solid #666; border-radius: 4px; }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∂–µ—Å—Ç–æ–≤ */
        #gesture-hint {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--android-green);
            color: black;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            z-index: 10000;
        }
    </style>
</head>
<body>

<div id="phone">
    <div class="status-bar">
        <span id="clock">12:00</span>
        <span>üì∂ üîã 100%</span>
    </div>

    <div id="cam-layer">
        <video id="input_video"></video>
    </div>

    <div id="gesture-hint">–î–ï–ô–°–¢–í–ò–ï</div>

    <div id="screen-content">
        <!-- –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª -->
        <div id="desktop" class="desktop">
            <div class="app-node active" data-app="tiktok">
                <div class="app-icon" style="background: #000; border: 1px solid #333;">üì±</div>
                <span>TikTok</span>
            </div>
            <div class="app-node" data-app="photos">
                <div class="app-icon" style="background: #fff;">üñºÔ∏è</div>
                <span>–§–æ—Ç–æ</span>
            </div>
            <div class="app-node" data-app="web">
                <div class="app-icon" style="background: #2196F3;">üåê</div>
                <span>Browser</span>
            </div>
            <div class="app-node" data-app="settings">
                <div class="app-icon" style="background: #9E9E9E;">‚öôÔ∏è</div>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
        </div>

        <!-- Fake TikTok App -->
        <div id="tiktok-app">
            <div id="tt-container" style="height: 100%; transition: transform 0.4s ease-out;">
                <div class="tt-video" style="background: linear-gradient(45deg, #f06, #4a9);">
                    –í–∏–¥–µ–æ 1: –¢–∞–Ω—Ü—ã
                    <div class="tt-ui"><div class="tt-btn">‚ù§Ô∏è</div><div class="tt-btn">üí¨</div></div>
                </div>
                <div class="tt-video" style="background: linear-gradient(45deg, #2196F3, #f44336);">
                    –í–∏–¥–µ–æ 2: –ö–æ—Ç—è—Ç–∫–∏
                    <div class="tt-ui"><div class="tt-btn">‚ù§Ô∏è</div><div class="tt-btn">üí¨</div></div>
                </div>
                <div class="tt-video" style="background: linear-gradient(45deg, #FFEB3B, #4CAF50);">
                    –í–∏–¥–µ–æ 3: –õ–∞–π—Ñ—Ö–∞–∫
                    <div class="tt-ui"><div class="tt-btn">‚ù§Ô∏è</div><div class="tt-btn">üí¨</div></div>
                </div>
                <div class="tt-video" style="background: linear-gradient(45deg, #9C27B0, #00BCD4);">
                    –í–∏–¥–µ–æ 4: –ú–∞—à–∏–Ω—ã
                    <div class="tt-ui"><div class="tt-btn">‚ù§Ô∏è</div><div class="tt-btn">üí¨</div></div>
                </div>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-btn" style="transform: rotate(-45deg); border-right:none; border-top:none; width:12px; height:12px;"></div>
        <div class="nav-btn" style="border-radius: 50%; width: 22px; height: 22px;"></div>
        <div class="nav-btn"></div>
    </div>
</div>

<script>
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    setInterval(() => {
        const d = new Date();
        document.getElementById('clock').innerText = d.getHours() + ":" + String(d.getMinutes()).padStart(2, '0');
    }, 1000);

    const desktop = document.getElementById('desktop');
    const tiktokApp = document.getElementById('tiktok-app');
    const ttContainer = document.getElementById('tt-container');
    const hint = document.getElementById('gesture-hint');
    const appNodes = document.querySelectorAll('.app-node');

    let currentMode = 'home'; // home –∏–ª–∏ tiktok
    let selectedAppIdx = 0;
    let ttScrollIdx = 0;
    let lastAction = 0;

    function showHint(text) {
        hint.innerText = text;
        hint.style.display = 'block';
        setTimeout(() => hint.style.display = 'none', 1000);
    }

    function onResults(results) {
        if (!results.multiFaceLandmarks || results.multiFaceLandmarks.length === 0) return;
        const pts = results.multiFaceLandmarks[0];
        const now = Date.now();

        // 1. –ú–û–†–ì–ê–ù–ò–ï (–ö–ª–∏–∫ –∏–ª–∏ –≤—Ö–æ–¥)
        const leftEye = pts[145].y - pts[159].y;
        if (leftEye < 0.012 && now - lastAction > 1000) {
            if (currentMode === 'home') {
                const appName = appNodes[selectedAppIdx].getAttribute('data-app');
                if (appName === 'tiktok') {
                    currentMode = 'tiktok';
                    tiktokApp.style.display = 'flex';
                    desktop.style.display = 'none';
                    showHint("–û–¢–ö–†–´–¢ TIKTOK");
                }
            } else {
                // –ï—Å–ª–∏ –≤ –¢–∏–∫–¢–æ–∫–µ –∑–∞–∂–º—É—Ä–∏—Ç—å—Å—è –Ω–∞–¥–æ–ª–≥–æ - –≤—ã—Ö–æ–¥
                if (leftEye < 0.008) {
                    currentMode = 'home';
                    tiktokApp.style.display = 'none';
                    desktop.style.display = 'grid';
                    showHint("–í–´–•–û–î –î–û–ú–û–ô");
                }
            }
            lastAction = now;
        }

        // 2. –Ø–ó–´–ö/–†–û–¢ (–í–ª–µ–≤–æ/–í–ø—Ä–∞–≤–æ)
        const mouthX = (pts[61].x + pts[291].x) / 2;
        const noseX = pts[1].x;
        const mouthShift = mouthX - noseX;

        if (currentMode === 'home' && now - lastAction > 500) {
            if (mouthShift < -0.025) { // –†–æ—Ç –≤–ª–µ–≤–æ
                selectedAppIdx = Math.max(0, selectedAppIdx - 1);
                updateDesktop();
                lastAction = now;
            } else if (mouthShift > 0.025) { // –†–æ—Ç –≤–ø—Ä–∞–≤–æ
                selectedAppIdx = Math.min(appNodes.length - 1, selectedAppIdx + 1);
                updateDesktop();
                lastAction = now;
            }
        }

        // 3. –û–¢–ö–†–´–¢–´–ô –†–û–¢ (–°–∫—Ä–æ–ª–ª –≤ –¢–∏–∫–¢–æ–∫)
        const mouthOpen = pts[14].y - pts[13].y;
        if (currentMode === 'tiktok' && mouthOpen > 0.06 && now - lastAction > 1200) {
            ttScrollIdx = (ttScrollIdx + 1) % 4; // –õ–∏—Å—Ç–∞–µ–º –ø–æ –∫—Ä—É–≥—É
            ttContainer.style.transform = `translateY(-${ttScrollIdx * 100}%)`;
            showHint("–°–õ–ï–î–£–Æ–©–ï–ï –í–ò–î–ï–û");
            lastAction = now;
        }
    }

    function updateDesktop() {
        appNodes.forEach((node, i) => {
            node.classList.toggle('active', i === selectedAppIdx);
        });
    }

    const faceMesh = new FaceMesh({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`});
    faceMesh.setOptions({ refineLandmarks: true, minDetectionConfidence: 0.5 });
    faceMesh.onResults(onResults);

    const camera = new Camera(document.getElementById('input_video'), {
        onFrame: async () => { await faceMesh.send({image: document.getElementById('input_video')}); },
        width: 480, height: 640
    });
    camera.start();
</script>
</body>
</html>
