<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Face Control</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <style>
        :root { --primary-color: #3ddc84; } /* Android Green */
        body { margin: 0; padding: 0; background: #000; font-family: 'Roboto', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* –ö–æ—Ä–ø—É—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        .phone-frame {
            width: 360px;
            height: 740px;
            background: #121212;
            border: 12px solid #333;
            border-radius: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* –°—Ç–∞—Ç—É—Å-–±–∞—Ä */
        .status-bar {
            height: 30px;
            padding: 5px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 12px;
            background: rgba(0,0,0,0.2);
        }

        /* –†–∞–±–æ—á–∏–π —Å—Ç–æ–ª */
        .home-screen {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            height: 80%;
        }

        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            font-size: 10px;
            transition: 0.2s;
            padding: 10px;
            border-radius: 15px;
        }

        .icon-shape {
            width: 50px;
            height: 50px;
            background: #444;
            border-radius: 12px;
            margin-bottom: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Ñ–æ–∫—É—Å–∞ (–∫—É—Ä—Å–æ—Ä) */
        .app-icon.selected {
            background: rgba(61, 220, 132, 0.3);
            transform: scale(1.2);
            border: 2px solid var(--primary-color);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .nav-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(0,0,0,0.8);
        }
        .nav-item { width: 20px; height: 20px; border: 2px solid #777; border-radius: 4px; }
        .nav-circle { border-radius: 50%; width: 25px; height: 25px; }

        /* –í–∏–¥–∂–µ—Ç –∫–∞–º–µ—Ä—ã (–º–∏–Ω–∏) */
        #video-container {
            position: absolute;
            top: 40px;
            right: 20px;
            width: 80px;
            height: 110px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--primary-color);
            z-index: 100;
        }
        video { transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover; }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–µ–π—Å—Ç–≤–∏–π */
        .action-toast {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary-color);
            color: black;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

<div class="phone-frame">
    <div class="status-bar">
        <span>12:45</span>
        <span>üì∂ üîã 98%</span>
    </div>

    <div id="video-container">
        <video id="input_video"></video>
    </div>

    <div class="home-screen" id="home">
        <!-- –ò–∫–æ–Ω–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JS -->
    </div>

    <div id="toast" class="action-toast">–ö–õ–ò–ö!</div>

    <div class="nav-bar">
        <div class="nav-item" style="border-left: 3px solid #777; border-bottom: 3px solid #777; transform: rotate(45deg); width: 12px; height: 12px; border-radius: 0;"></div>
        <div class="nav-item nav-circle"></div>
        <div class="nav-item" style="width: 18px; height: 18px;"></div>
    </div>
</div>

<script>
    const home = document.getElementById('home');
    const toast = document.getElementById('toast');
    const apps = [
        {name: '–¢–µ–ª–µ—Ñ–æ–Ω', img: 'üìû', color: '#4CAF50'},
        {name: '–°–æ–æ–±—â–µ–Ω–∏—è', img: 'üí¨', color: '#2196F3'},
        {name: 'Chrome', img: 'üåê', color: '#FBBC05'},
        {name: 'YouTube', img: '‚ñ∂Ô∏è', color: '#FF0000'},
        {name: '–ö–∞–º–µ—Ä–∞', img: 'üì∑', color: '#607D8B'},
        {name: '–ö–∞—Ä—Ç—ã', img: 'üìç', color: '#E91E63'},
        {name: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', img: '‚öôÔ∏è', color: '#9E9E9E'},
        {name: '–ì–∞–ª–µ—Ä–µ—è', img: 'üñºÔ∏è', color: '#FF9800'}
    ];

    // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    apps.forEach((app, i) => {
        const div = document.createElement('div');
        div.className = 'app-icon';
        div.id = 'app-' + i;
        div.innerHTML = `<div class="icon-shape" style="background:${app.color}">${app.img}</div><span>${app.name}</span>`;
        home.appendChild(div);
    });

    let currentIndex = 0;
    function updateSelection(newIndex) {
        document.querySelectorAll('.app-icon').forEach(el => el.classList.remove('selected'));
        currentIndex = (newIndex + apps.length) % apps.length;
        document.getElementById('app-' + currentIndex).classList.add('selected');
    }
    updateSelection(0);

    const videoElement = document.getElementById('input_video');
    let lastActionTime = 0;

    function onResults(results) {
        if (!results.multiFaceLandmarks || results.multiFaceLandmarks.length === 0) return;
        const points = results.multiFaceLandmarks[0];
        const now = Date.now();

        // 1. –ú–û–†–ì–ê–ù–ò–ï -> –ö–õ–ò–ö
        const eyeDist = points[145].y - points[159].y; 
        if (eyeDist < 0.013 && now - lastActionTime > 800) {
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 500);
            lastActionTime = now;
        }

        // 2. –î–í–ò–ñ–ï–ù–ò–ï –†–¢–ê -> –í–õ–ï–í–û/–í–ü–†–ê–í–û
        const mouthCenter = (points[61].x + points[291].x) / 2;
        const noseTip = points[1].x;
        const shift = mouthCenter - noseTip;

        if (now - lastActionTime > 400) {
            if (shift < -0.025) { // –†–æ—Ç –≤–ª–µ–≤–æ
                updateSelection(currentIndex - 1);
                lastActionTime = now;
            } else if (shift > 0.025) { // –†–æ—Ç –≤–ø—Ä–∞–≤–æ
                updateSelection(currentIndex + 1);
                lastActionTime = now;
            }
        }

        // 3. –û–¢–ö–†–´–¢–´–ô –†–û–¢ -> –°–ö–†–û–õ–õ (–ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫)
        const mouthOpen = points[14].y - points[13].y;
        if (mouthOpen > 0.05) {
            home.style.transform = `translateY(${-Math.sin(now/200)*10}px)`;
        } else {
            home.style.transform = `translateY(0)`;
        }
    }

    const faceMesh = new FaceMesh({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`});
    faceMesh.setOptions({ refineLandmarks: true, minDetectionConfidence: 0.5 });
    faceMesh.onResults(onResults);

    const camera = new Camera(videoElement, {
        onFrame: async () => { await faceMesh.send({image: videoElement}); },
        width: 480, height: 640
    });
    camera.start();
</script>
</body>
</html>
